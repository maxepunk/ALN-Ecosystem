Loaded shared scoring config from: /home/maxepunk/projects/AboutLastNight/ALN-Ecosystem/ALN-TokenData/scoring-config.json

Running 2 tests using 1 worker

Loaded shared scoring config from: /home/maxepunk/projects/AboutLastNight/ALN-Ecosystem/ALN-TokenData/scoring-config.json
{"level":"info","message":"Setting up VLC for E2E tests...","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:12.843"}
{"level":"info","message":"Using existing VLC instance","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:12.892"}
{"level":"info","message":"[E2E Sound] pw-play available, copied 1 test audio file(s)","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:12.908"}
{"level":"info","message":"[E2E HA] Home Assistant API already healthy","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:12.924"}
{"level":"info","message":"[E2E Spotify] spotifyd running but no MPRIS registration (no active Spotify Connect session)","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:17.988"}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  E2E SERVICE STATUS                      â•‘
â•‘  vlc        REAL                           â•‘
â•‘  spotify    REAL (running but no active Spotify Connect session â€” MPRIS commands will fail until a client connects)  â•‘
â•‘  ha         REAL                           â•‘
â•‘  sound      REAL                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{"level":"info","message":"Starting orchestrator for E2E tests","metadata":{"metadata":{"enableHttps":true,"port":42963,"preserveSession":false,"protocol":"https","service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:17.998"}
{"level":"info","message":"Orchestrator started successfully","metadata":{"metadata":{"pid":223610,"service":"aln-orchestrator","url":"https://localhost:42963"}},"timestamp":"2026-02-15 12:43:18.578"}
âœ“ Fetched 48 tokens from https://localhost:42963/api/tokens
  â†’ Selected group "Marcus Sucks" with 4 tokens (returning all 4)
  â†’ Video token verified: jaw011.mp4 exists at /home/maxepunk/projects/AboutLastNight/ALN-Ecosystem/backend/public/videos
Token Selection Summary:
  â†’ Personal token: fli003 (2â­)
  â†’ Business token: din021 (3â­)
  â†’ Technical token: mab001 (5â­)
  â†’ Video token: jaw011
  â†’ Group tokens: asm031, fli031, jek031, rat031
  â†’ Unique tokens: alr001, alr002, asm042... (5 total)
Token Pools Selected:
  â†’ Round 1 tokens: alr001, alr002, asm031, asm042, det001, det002, din002, din021, fli002
  â†’ Round 2 tokens: fli003, fli004, fli031, hos002, hos011, jav003, jav021, jav042, jek002
  â†’ Video tokens: jaw011, kaa003
Browser launched for multi-device tests
{"level":"info","message":"Stopping orchestrator","metadata":{"metadata":{"pid":223610,"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:20.625"}
{"level":"info","message":"Cleaning up VLC resources...","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:20.635"}
{"level":"info","message":"VLC cleanup complete","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:20.636"}
  -  1 [chromium] â€º tests/e2e/flows/30-full-game-session-multi-device.test.js:157:3 â€º Full Game Session Multi-Device Flow â€º complete game session with multiple GM and player scanners
Loaded shared scoring config from: /home/maxepunk/projects/AboutLastNight/ALN-Ecosystem/ALN-TokenData/scoring-config.json
{"level":"info","message":"Setting up VLC for E2E tests...","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:21.820"}
{"level":"info","message":"Using existing VLC instance","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:21.881"}
{"level":"info","message":"[E2E Sound] pw-play available, copied 1 test audio file(s)","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:21.902"}
{"level":"info","message":"[E2E HA] Home Assistant API already healthy","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:21.922"}
{"level":"info","message":"[E2E Spotify] spotifyd running but no MPRIS registration (no active Spotify Connect session)","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:26.989"}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  E2E SERVICE STATUS                      â•‘
â•‘  vlc        REAL                           â•‘
â•‘  spotify    REAL (running but no active Spotify Connect session â€” MPRIS commands will fail until a client connects)  â•‘
â•‘  ha         REAL                           â•‘
â•‘  sound      REAL                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{"level":"info","message":"Starting orchestrator for E2E tests","metadata":{"metadata":{"enableHttps":true,"port":41267,"preserveSession":false,"protocol":"https","service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:43:26.999"}
{"level":"info","message":"Orchestrator started successfully","metadata":{"metadata":{"pid":223785,"service":"aln-orchestrator","url":"https://localhost:41267"}},"timestamp":"2026-02-15 12:43:27.579"}
âœ“ Fetched 48 tokens from https://localhost:41267/api/tokens
  â†’ Selected group "Marcus Sucks" with 4 tokens (returning all 4)
  â†’ Video token verified: jaw011.mp4 exists at /home/maxepunk/projects/AboutLastNight/ALN-Ecosystem/backend/public/videos
Token Selection Summary:
  â†’ Personal token: fli003 (2â­)
  â†’ Business token: din021 (3â­)
  â†’ Technical token: mab001 (5â­)
  â†’ Video token: jaw011
  â†’ Group tokens: asm031, fli031, jek031, rat031
  â†’ Unique tokens: alr001, alr002, asm042... (5 total)
Token Pools Selected:
  â†’ Round 1 tokens: alr001, alr002, asm031, asm042, det001, det002, din002, din021, fli002
  â†’ Round 2 tokens: fli003, fli004, fli031, hos002, hos011, jav003, jav021, jav042, jek002
  â†’ Video tokens: jaw011, kaa003
Browser launched for multi-device tests

=== PHASE 1: Setup & Session Creation ===
âœ“ Public scoreboard connected
âœ“ GM Scanner initialized: networked mode, blackmarket game mode
âœ“ GM1 connected in networked mode
âœ“ Admin panel navigation complete - data loaded
âœ“ Admin panel navigation complete - data loaded
âœ“ Session created with Team Alpha and Team Beta
âœ“ Scoreboard still connected after session creation
âœ“ GM Scanner initialized: networked mode, detective game mode
âœ“ GM2 connected in detective mode
âœ“ Mode verification: GM1=Black Market Mode, GM2=Detective Mode

=== PHASE 1.5: Environment Control Verification ===
âœ“ Admin panel navigation complete - data loaded
âœ“ Audio routing dropdowns visible
âœ“ Initial video route value: alsa_output.platform-107c701400.hdmi.hdmi-stereo
  Available video sinks: HDMI
âš  Skipping route toggle test: only 1 sink available (CI environment?)
  BT fallback warning: hidden
  â†’ BT Scan button initial text: "Scan for Speakers"
  â†’ Clicked BT Scan button (gm:command bluetooth:scan:start sent)
  BT scan still running after 15s, moving on
  BT devices found: 3
  â†’ Activating scene: "Party" (scene.party)
âœ“ Lighting scene "Party" activated (round-trip verified)
Environment Control State: {
  "audioSectionVisible": true,
  "videoRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "spotifyRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "soundRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "btWarningVisible": false,
  "btUnavailable": false,
  "btDeviceCount": 5,
  "lightingSectionVisible": true,
  "lightingNotConnected": false,
  "lightingSceneCount": 3
}

=== PHASE 1.6: Game Clock + Compound Cues ===
âœ“ Game clock running: 00:00:07
  â†’ Firing clock-driven compound cue: e2e-compound-test
âœ“ Compound cue active in UI, state: 
              Running
            
âš ï¸ Lighting scene verification timed out (HA may have lost connection)
âœ“ Clock-driven compound cue completed (removed from active cues UI)
  â†’ Firing video-driven compound cue: e2e-video-compound
âœ“ Video compound cue active in UI
âœ“ VLC video playing (progress container visible)
âœ“ Video-driven compound cue completed
âœ“ Spotify status rendered in UI (connected: false)
  Note: running but no active Spotify Connect session â€” MPRIS commands will fail until a client connects
=== Phase 1.6 Complete ===


=== PHASE 2: Player Scanners Join ===
âœ“ All 3 player scanners connected

=== PHASE 3: GM Processing Round 1 Tokens ===
  â†’ GM2 (Detective) scanned alr001 for Team Alpha 1771188207764
  â†’ GM2 (Detective) scanned alr002 for Team Alpha 1771188207764
  â†’ GM2 (Detective) scanned asm031 for Team Alpha 1771188207764
âœ“ GM2 history shows 3 transactions
âœ“ Public scoreboard shows 3 total evidence (hero + feed)
  â†’ GM1 (Blackmarket) scanned asm042 for Team Beta 1771188207764
  â†’ GM1 (Blackmarket) scanned det001 for Team Beta 1771188207764
  â†’ GM1 (Blackmarket) scanned det002 for Team Beta 1771188207764
âœ“ GM1 history shows 6 total session transactions (3 detective + 3 blackmarket)
âœ“ GM1 scoreboard shows Team Beta with score: $800000

=== PHASE 4: Video Token Handling ===
âœ“ Video alert displayed for token jaw011: "VIDEO MEMORY"
âœ“ Video alert auto-dismissed

=== PHASE 5: New Team Creation & Round 2 Processing ===
âœ“ Team Gamma created mid-session by GM1 (now on scan screen)
âœ“ Team Gamma now available in GM1 team list
âœ“ Team Gamma synced to GM2 - multi-GM team sync verified
  â†’ GM1 (Blackmarket) scanned fli003 for Team Gamma 1771188207764
  â†’ GM1 (Blackmarket) scanned fli004 for Team Gamma 1771188207764
  â†’ GM1 (Blackmarket) scanned fli031 for Team Gamma 1771188207764
âœ“ GM1 scoreboard shows 3 team entries
âœ“ Public scoreboard shows 2 score entries

=== PHASE 5b: Score Adjustment ===
Team Beta score before adjustment: $800000
[GMScannerPage] Intervention controls visible
[GMScannerPage] Filled adjustment input: 5000
[GMScannerPage] Filled reason: E2E test bonus
[GMScannerPage] Clicked adjust button
âœ“ GM1 adjusted Team Beta score by +$5000
Team Beta score after adjustment: $805000
âœ“ Score adjustment verified: $800000 â†’ $805000

=== PHASE 6: Transaction Deletion & Rescan ===
âœ“ GM1 still in blackmarket mode
âœ“ GM1 scanned hos002 as blackmarket for Team Beta 1771188207764
âœ“ Opened team details for Team Beta 1771188207764
âš ï¸ Token hos002 not visible in team details, skipping deletion
âœ“ GM1 switched to detective mode for rescan
âœ“ GM1 rescanned hos002 as detective for Team Beta 1771188207764

=== PHASE 7: Final Verification ===
âœ“ GM1 final history count: 11 transactions
âœ“ GM2 final history count: 11 transactions
âœ“ Final public scoreboard: 2 score entries, 2 evidence cards
âœ“ Admin panel navigation complete - data loaded
âœ“ Environment control state persisted through full session
Final Environment State: {
  "audioSectionVisible": true,
  "videoRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "spotifyRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "soundRoute": "alsa_output.platform-107c701400.hdmi.hdmi-stereo",
  "btWarningVisible": false,
  "btUnavailable": false,
  "btDeviceCount": 2,
  "lightingSectionVisible": true,
  "lightingNotConnected": false,
  "lightingSceneCount": 3
}

=== Ending Session ===
âœ“ Session ended
âœ“ Scoreboard still connected after session end

=== TEST COMPLETE ===
Summary:
  - Teams: Team Alpha 1771188207764, Team Beta 1771188207764, Team Gamma 1771188207764
  - GM1 transactions: 11
  - GM2 transactions: 11
  - Public scoreboard entries: 2
  - Evidence cards: 2
{"level":"info","message":"Stopping orchestrator","metadata":{"metadata":{"pid":223785,"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:44:56.963"}
{"level":"info","message":"Cleaning up VLC resources...","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:44:56.972"}
{"level":"info","message":"VLC cleanup complete","metadata":{"metadata":{"service":"aln-orchestrator"}},"timestamp":"2026-02-15 12:44:56.973"}
  âœ“  2 [mobile-chrome] â€º tests/e2e/flows/30-full-game-session-multi-device.test.js:157:3 â€º Full Game Session Multi-Device Flow â€º complete game session with multiple GM and player scanners (1.5m)

  1 skipped
  1 passed (1.8m)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m
